# CTP期货行情测试工具

基于VeighNa框架的CTP期货行情连接测试工具，支持多行情服务器地址自动切换和行情订阅测试。

## 功能特点

- 支持多行情服务器地址配置（自动使用首个可用连接）
- 支持智能域名模板解析（批量生成服务器地址）
- 纯行情接口实现，无交易功能
- 集成自动化测试框架
- 跨平台兼容性支持（Windows/Linux）

## 系统要求

- Python 3.10+
- VeighNa 3.9.4+
- vnpy_ctp
- pytest (用于测试)

## 快速开始

1. 安装依赖：
```bash
pip install numpy ta-lib vnpy==3.9.4 pytest vnpy_ctp
```
ta-lib安装可借鉴CI/CD配置内容 [文档](/.github/workflows/test.yml)

2. 配置连接信息：
- 创建 `connect_ctp_7_24.json` 文件，包含以下信息：
```json
{
    "用户名": "",  // 可留空，本项目不使用
    "密码": "",  // 可留空，本项目不使用
    "经纪商代码": "YOUR_BROKER_ID",
    "行情服务器": "YOUR_MD_SERVER",  // 支持多地址格式
    "交易服务器": "",  // 可留空，本项目不使用
    "产品名称": "",
    "授权编码": ""
}
```

3. 运行测试：
```bash
pytest tests/test_md_ctp.py -v
```

4. 启动行情连接：
```bash
python run_barGen_7_24.py
```

## 项目结构

```
├── prod/
│   ├── ctp_gateway_patch.py     # CTP网关扩展实现（仅行情部分）
│   └── __init__.py
├── tests/
│   └── test_md_ctp.py          # 行情连接测试用例
├── .github/
│   └── workflows/
│       └── test.yml            # CI/CD配置
├── run_barGen_7_24.py          # 主程序入口（7x24）
├── run_barGen国信5档.py         # 国信测试入口
├── run_barGen中信域名.py        # 中信测试入口
└── README.md                   # 项目文档
```

## 主要特性

### 1. 多地址支持
支持以下格式的行情服务器地址配置：
- 单个地址：`tcp://127.0.0.1:8888`
- 逗号分隔多地址：`tcp://127.0.0.1:8888,tcp://127.0.0.2:8888`
- 域名模板（自动展开）：`ctp1-front{1,3/5,8,10/18}.citicsf.com`

注意：系统会自动尝试连接所有配置的地址，使用首个成功建立的连接。

### 2. 行情测试
- 连接状态检测
- 行情订阅验证
- 数据接收确认

## CI/CD支持

项目集成了GitHub Actions自动化工作流：
- 多平台测试（Windows/Linux）
- Python 3.12环境支持
- 自动依赖安装
- 行情接口连接测试

## 更新公告

### 2025-03-17
1. 架构优化
   - 引入 `ctp_gateway_patch.py` 继承机制，实现纯行情功能
   - 移除对预编译模块的强依赖，提升兼容性

2. 功能增强
   - 支持多行情服务器地址配置
   - 实现域名模板自动解析
   - 优化行情订阅逻辑，添加合约-交易所映射缓存

3. 测试框架
   - 新增行情连接自动化测试
   - 集成CI/CD工作流
   - 支持多平台测试

4. 文档完善
   - 明确项目定位和功能范围
   - 补充多地址配置说明
   - 更新开发者指南

## 注意事项

1. 本工具仅用于行情连接测试，不包含交易功能
2. 正确配置行情服务器地址，支持多地址备份
3. 遵守交易所连接频率限制
4. 定期检查连接状态日志

## 许可证

本项目采用 MIT 许可证 